<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>K3B</title>
</head>

<body>
  <h1>K3B</h1>

  <img src="./k3b.png" />

  <h2>Be a maintainer</h2>
  <p>I fixed <a href="https://bugs.kde.org/show_bug.cgi?id=365089" target="_blank">KDEBUG-365089</a> my colleague, found that it fell into the infinte loop when selecting file and burning ISO, reported the bug to me in the internal <a href="https://www.bugzilla.org/" target="_blank">bugzilla</a>, then I <a href="https://mail.kde.org/pipermail/release-team/2016-July/009570.html" target="_blank">sent an email</a> to KDE release-team for asking whether or not make a tag for kf5 branch with <a href="https://git.reviewboard.kde.org/r/128376" target="_blank">my patch</a>. Fortunatly <a href="http://www.purinchu.net/wp/" target="_blank">Michael Pyne</a> quickly <a href="https://mail.kde.org/pipermail/release-team/2016-July/009571.html" target="_blank">repiled me</a>, and he asked did you want to take over maintenance of K3B? I found out previouse maintainers and core developers' email via git log, then email them, but *NO* reply yet, so I am maintaing it now.</p>
  
  <p>And my sincere thank will go to <a href="https://www.kdab.com/~dfaure/" target="_blank">David Faure</a>, he <a href="https://mail.kde.org/pipermail/release-team/2016-July/009583.html" target="_blank">covered me</a> owing to I broke the dependency freeze of <a href="https://github.com/KDE/libkcddb" target="_blank">libkcddb</a> regarding the Applications/16.08 release. So I <a href="https://mail.kde.org/pipermail/release-team/2016-July/009628.html" target="_blank">migrated</a> all projects requires KF5Cddb, and right now libkcddb is KF5 ready!</p>

  <h2>Bug hunter</h2>
  <p>I am looking for relative bugs via <a href="https://mail.kde.org/pipermail/k3b/" target="_blank">mailing list</a>. So please <a href="https://bugs.kde.org/" target="_blank">report bug</a> and CC to xiangzhai83@gmail.com if you found one.</p>

  <ul>
  <li><a href="https://bugs.kde.org/show_bug.cgi?id=367639" target="_blank">KDEBUG-367639</a></li>
  <p>Please remove wodim (<a href="https://lists.debian.org/debian-devel-announce/2006/09/msg00002.html" target="_blank">forked cdrecord</a>) from <a href="https://en.wikipedia.org/wiki/Cdrkit" target="_blank">cdrkit</a> (CD only, DVD deprecated, unmaintained), <a href="http://www.cdrkit.org" target="_blank">website</a> was down, <a href="http://cdrkit.org/releases/cdrkit-1.1.11.tar.gz" target="_blank">release tarball</a> is *NOT* available, <a href="https://anonscm.debian.org/viewvc/debburn/cdrkit/" target="_blank">svn repos</a> is so quiet! But install <a href="https://en.wikipedia.org/wiki/Cdrtools" target="_blank">cdrtools</a> A.K.A <a href="http://cdrtools.sourceforge.net/private/cdrecord.html" target="_blank">cdrecord</a> instead.</p>

  <p>growisofs from <a href="http://fy.chalmers.se/~appro/linux/DVD+RW/" target="_blank">dvd+rw-tools</a> (DVD and BD only) is a frontend to mkisofs, as <a href="http://fy.chalmers.se/~appro/linux/DVD+RW/tools/growisofs.c" target="_blank">growisofs.c</a> changlog described: <pre>
   * - copy volume descriptors if -C was specified with -M /dev/dvd=image             
   *   [by request from K3b];
  </pre>then how growisofs parsing -C parameter?<pre><code>
        else if (argv[i][1] == 'C' || !strncmp(opt,"-cdrecord-params",16))
	    { char *s=argv[i+1];
	      int   i1,i2;
		if (argv[i][1]=='C' &amp;&amp; len&gt;2)	s=argv[i]+2;
		else				i++;
		if (sscanf (s,"%d,%d",&amp;i1,&amp;i2) == 2)
		    alleged_next_session=i2;
		continue;
	    }
  </code></pre>so if wrongly use <code>growisofs -C 0,0 ...</code> the <code>char* s</code> is <code>0,0</code> and alleged_next_session is <code>0</code> then construct next session for you <code>next_session=setup_C_parm(C_parm,saved_descriptors);</code> but if <code>alleged_next_session!=next_session</code>, it will throw <code>-C argument is insane</code> error!</p>

  <li><a href="https://bugs.kde.org/show_bug.cgi?id=360170" target="_blank">KDEBUG-360170</a></li>
  <p>It is not encrypted issue, <a href="http://www.videolan.org/developers/libdvdcss.html" target="_blank">libdvdcss</a> is able to access and unscramb DVDs encrypted with the Content Scramble System (CSS), but transcode failed to rip videodvd (see <a href="https://pbs.twimg.com/media/CrJ54YmVYAEDLL9.jpg" target="_blank">screenshot</a>) using mplayer to test the output *.avi, and debug info <a href="https://gist.github.com/xiangzhai/378d092bfec1d5abd76d37c8c7d326f6" target="_blank">goes here</a>. There is a looping failure for libdvdread's <a href="https://code.videolan.org/videolan/libdvdread/blob/master/src/nav_read.c#L264" target="_blank"><code>CHECK_VALUE(dsi-&gt;dsi_gi.zero1 == 0)</code></a>, but it doesn't matter, using <a href="http://tuxtweaks.com/2014/02/rip-dvd-mplayer/" target="_blank">mplayer to rip videodvd</a> <code>mplayer -dumpstream dvd:////dev/sr0 -nocache -dumpfile test.mpg</code> also print out such stuff! But pay more attention to ffmpeg libavcodec's warning: <pre>
  [mpeg4 @ 0x55a0daf96a40] AVFrame.format is not set
  [mpeg4 @ 0x55a0daf96a40] AVFrame.width or height is not set
  </pre>
  I <a href="https://bitbucket.org/france/transcode-tcforge/issues/8/rip-dvd-avframeformat-is-not-set" target="_blank">reported the issue</a> to ?UPSTREAM? ArchLinux packager choosing <a href="https://bitbucket.org/france/transcode-tcforge/downloads" target="_blank">transcode-1.1.7</a>'s tarball, but transcoding.org domain relocating to https://bitbucket.org/achurch_/transcode/wiki/Home, so I have no idea what happened - yet another transcode v1.2.0-d302c3a215bb, and failed to build for ffmpeg v3.1.3, then I <a href="https://bitbucket.org/achurch_/transcode/pull-requests/1/migrate-to-ffmpeg-313/diff" target="_blank">migrated it</a>, *NOT* be merged again! transcode-1.2 (binary name) still failed to rip videodvd, same story as the screenshot.
  </p>

  <li><a href="https://bugs.kde.org/show_bug.cgi?id=344392" target="_blank">KDEBUG-344392</a></li>
  <p>*NON* ISO image testcase: <code>dd if=/dev/zero bs=1M count=100 of=~/virt.img</code> and use CDEmu to test it ;-)</p>

  <li><a href="https://bugs.kde.org/show_bug.cgi?id=328529" target="_blank">KDEBUG-328529</a></li>
  <p>Even use <a href="http://cppcheck.sourceforge.net/" target="_blank">Cppcheck</a> to do static analysis, it can *NOT* check such issue: <pre>
  quint16 K3b::Device::from2Byte( const unsigned char* d )
  {
+    if (d == NULL) {
+        qWarning() &lt;&lt; "Invalid nullptr!";
+        return 0;
+    }
     return ( (d[0] &lt;&lt; 8 &amp; 0xFF00) |
              (d[1]      &amp; 0xFF) );
  }
  </pre></p>

  <li><a href="https://bugs.kde.org/show_bug.cgi?id=257602" target="_blank">KDEBUG-257602</a></li>
  <p>*NO* <a href="https://en.wikipedia.org/wiki/Universal_Disk_Format" target="_blank">UDF</a> v2.6.x implemented for <a href="https://github.com/torvalds/linux/blob/master/fs/udf/osta_udf.h#L4" target="_blank">Linux kernel</a> yet! Perhaps we can deep into it and try to support it ;-)</p>
  </ul>
  
  <h2>Test enviroment</h2>
  <p>As a maintainer or debuger, at least need <a href="https://pbs.twimg.com/media/CrT91GfVUAAyX9Z.jpg" target="_blank">plugable CD/DVD driver</a>, some <a href="https://pbs.twimg.com/media/CrT91x6UAAA5Hmd.jpg" target="_blank">Audio CD and Video DVD</a>, but if *NOT* have CD/DVD driver nor empty CD/DVD/Blu-ray disc to test, <a href="http://cdemu.sourceforge.net/" target="">CDEmu</a> is a good choice ;-)<pre>
  cdemu create-blank --writer-id=WRITER-ISO --medium-type=dvd+r 0 ~/virt.iso</pre> or <pre>
  cdemu create-blank --writer-id=WRITER-TOC --medium-type=cdr80 --param="writer.write_raw=1" --param="writer.write_subchannel=1" 0 ~/virt.toc
  </pre>then you can burning ArchLinux or Fedora iso to this virtual DVD disc media by K3B or command line <pre>cdrecord dev=/dev/sr0 ~/Download/archlinux-2016.05.01-dual.iso</pre></p>

  <h2>Dependence</h2>
  <p>I use iSOFTLinux (<a href="https://github.com/isoft-linux/rpm/blob/isoftapp/README.md" target="_blank">M.O.D rpm</a>), <a href="https://www.archlinux.org/" target="_blank">ArchLinux</a> (pacman) and <a href="https://spins.fedoraproject.org/kde/" target="_blank">Fedora</a> (rpm). please run <code>sudo dnf upgrade --refresh</code> or <code>sudo pacman -Syu</code> to upgrade your system.

  <ul>
    <li><a href="https://github.com/KDE/extra-cmake-modules" target="_blank">ECM</a></li>
    <li><a href="http://doc.qt.io/qt-5/" target="_blank">Qt5</a> components</li>
    <li><a href="https://en.wikipedia.org/wiki/KDE_Frameworks_5" target="_blank">KF5</a> components</li>
    <li><a href="http://www.gnu.org/savannah-checkouts/gnu/libiconv/" target="_blank">libiconv</a></li>
    <li><a href="http://www.mega-nerd.com/SRC" target="_blank">libsamplerate</a></li>
    <li><a href="https://github.com/KDE/libkcddb" target="_blank">KF5Cddb</a></li>
    <li><a href="https://github.com/microe/libdvdread" target="_blank">libdvdread</a></li>
    <li><a href="http://www.freshmeat.net/projects/taglib" target="_blank">taglib</a></li>
    <li><a href="http://musicbrainz.org" target="_blank">musicbrainz</a></li>
    <li><a href="http://ffmpeg.org" target="_blank">ffmpeg</a></li>
    <li><a href="http://flac.sourceforge.net" target="_blank">flac</a></li>
    <li><a href="http://www.underbit.com/products/mad" target="_blank">mad</a></li>
    <li><a href="http://www.musepack.net" target="_blank">muse</a></li>
    <li><a href="http://www.mega-nerd.com/libsndfile" target="_blank">libsndfile</a></li>
    <li><a href="http://lame.sourceforge.net" target="_blank">lame</a></li>
    <li><a href="http://www.vorbis.com" target="_blank">ogg-vorbis</a></li>
    <li><a href="http://cdrtools.sourceforge.net/private/cdrecord.html" target="_blank">cdrecord</a></li>
    <a href="http://downloads.sourceforge.net/cdrtools/cdrtools-3.02a06.tar.bz2" target="_blank">cdrtools-3.02a06.tar.bz2</a><pre>
    export GMAKE_NOWARN=true
    make INS_BASE=/usr INS_RBASE=/
    sudo make install
    </pre>
  </ul>

  <h2>Build</h2>
  <pre><code>
  mkdir build
  cd build
  cmake .. -DCMAKE_INSTALL_PREFIX=/usr    \
    -DKDE_INSTALL_LIBDIR=lib    \
    -DKDE_INSTALL_LIBEXECDIR=lib    \
    -DKDE_INSTALL_USE_QT_SYS_PATHS=ON   \
    -DK3B_BUILD_API_DOCS=ON \
    -DK3B_ENABLE_PERMISSION_HELPER=ON   \
    -DK3B_DEBUG=ON
  make -j 5
  sudo make install
  </code></pre>

  <h2>Implementating NEW features</h2>
  <p>Firstly, as a KDE developer, I need to fix high priority bugs, but I will pay some attention to the implementation of NEW features reported by users. In fact what I fixed <a href="https://bugs.kde.org/show_bug.cgi?id=365604" target="_blank">KDEBUG-365604</a> is just the W.I.P implementation of <a href="https://github.com/KDE/k3b/tree/save-document-data" target="_blank">saving document data</a> for videodvd.</p>

</body>
</html>
